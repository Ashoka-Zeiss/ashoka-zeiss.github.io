<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Microscopy Training Schedule</title>
  <style>
    /* CSS Reset and Custom Properties */
    :root {
      /* Light mode colors */
      --color-bg: #ffffff;
      --color-surface: #f8f9fa;
      --color-surface-hover: #e9ecef;
      --color-text-primary: #212529;
      --color-text-secondary: #6c757d;
      --color-text-muted: #adb5bd;

      /* Category Colors */
      --color-online: #0096c7;
      --color-campus: #f77f00;
      --color-offcampus: #7209b7;

      /* Lab Type Colors - Subtle accents */
      --color-theory: #06ffa5;
      --color-wet-lab: #ff006e;
      --color-dry-lab: #0582ca;
      --color-computational: #06ffa5;

      /* UI Colors */
      --color-border: #dee2e6;
      --color-accent: #0096c7;

      /* Typography - Following Butterick's Principles */
      --font-sans: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', Roboto, sans-serif;
      --font-size-base: 16px;
      --line-height-base: 1.5;
      --line-height-heading: 1.3;

      /* Spacing Scale */
      --space-xs: 0.5rem;
      --space-sm: 0.75rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 3rem;

      /* Layout */
      --container-max: 1200px;
      --border-radius: 8px;
      --transition-base: 150ms ease-in-out;
    }

    /* Dark mode */
    [data-theme="dark"] {
      --color-bg: #1a1a1a;
      --color-surface: #242424;
      --color-surface-hover: #2a2a2a;
      --color-text-primary: #ffffff;
      --color-text-secondary: #a0a0a0;
      --color-text-muted: #6b6b6b;

      /* Category Colors */
      --color-online: #00D9D9;
      --color-campus: #FFB000;
      --color-offcampus: #8B5CF6;

      /* Lab Type Colors */
      --color-theory: #4ECDC4;
      --color-wet-lab: #FF6B6B;
      --color-dry-lab: #4DABF7;
      --color-computational: #51CF66;

      /* UI Colors */
      --color-border: #333333;
      --color-accent: #00D9D9;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-sans);
      font-size: var(--font-size-base);
      line-height: var(--line-height-base);
      background-color: var(--color-bg);
      color: var(--color-text-primary);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      transition: background-color var(--transition-base), color var(--transition-base);
    }

    /* Container and Layout */
    .container {
      max-width: var(--container-max);
      margin: 0 auto;
      padding: var(--space-md);
    }

    /* Header */
    .header {
      margin-bottom: var(--space-xl);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-size: 1.75rem;
      font-weight: 600;
      line-height: var(--line-height-heading);
    }

    /* Theme Toggle */
    .theme-toggle {
      background: none;
      border: 1px solid var(--color-border);
      color: var(--color-text-primary);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-base);
      position: relative;
    }

    .theme-toggle:hover {
      background-color: var(--color-surface-hover);
      border-color: var(--color-accent);
    }

    .theme-toggle svg {
      width: 20px;
      height: 20px;
      transition: transform var(--transition-base);
    }

    .theme-toggle:hover svg {
      transform: rotate(180deg);
    }

    .theme-icon {
      position: absolute;
      transition: opacity var(--transition-base);
    }

    .theme-icon.sun {
      opacity: 1;
    }

    .theme-icon.moon {
      opacity: 0;
    }

    [data-theme="dark"] .theme-icon.sun {
      opacity: 0;
    }

    [data-theme="dark"] .theme-icon.moon {
      opacity: 1;
    }

    /* Week Navigation with Stats */
    .week-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-lg);
      background-color: var(--color-surface);
      padding: var(--space-md);
      border-radius: var(--border-radius);
      position: relative;
    }

    .week-nav__info {
      display: flex;
      flex-direction: column;
      gap: var(--space-xs);
    }

    .week-nav__current {
      font-weight: 500;
      color: var(--color-text-primary);
    }

    .week-nav__stats {
      font-size: 0.75rem;
      color: var(--color-text-secondary);
      display: flex;
      gap: var(--space-md);
    }

    /* Time Context Section */
    .time-context {
      background-color: var(--color-surface);
      border-radius: var(--border-radius);
      padding: var(--space-md);
      margin-bottom: var(--space-lg);
      display: none;
    }

    .time-context.active {
      display: block;
    }

    .time-context__header {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--color-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: var(--space-sm);
    }

    .happening-now {
      background-color: var(--color-bg);
      border-left: 3px solid var(--color-accent);
      padding: var(--space-sm);
      border-radius: var(--border-radius);
      margin-bottom: var(--space-md);
    }

    .happening-now__title {
      font-weight: 600;
      color: var(--color-accent);
      margin-bottom: var(--space-xs);
    }

    .happening-now__session {
      font-size: 0.875rem;
      color: var(--color-text-primary);
    }

    .up-next {
      display: flex;
      gap: var(--space-md);
      flex-wrap: wrap;
    }

    .up-next__item {
      background-color: var(--color-bg);
      padding: var(--space-sm);
      border-radius: var(--border-radius);
      flex: 1;
      min-width: 200px;
    }

    .up-next__time {
      font-size: 0.75rem;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-xs);
    }

    .up-next__countdown {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--color-campus);
      margin-bottom: var(--space-xs);
    }

    .up-next__title {
      font-size: 0.875rem;
      color: var(--color-text-primary);
    }

    @media (max-width: 767px) {
      .up-next {
        flex-direction: column;
      }
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
    }

    .stat-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: currentColor;
    }

    .week-nav__controls {
      display: flex;
      gap: var(--space-sm);
    }

    .week-nav__button {
      background: none;
      border: 1px solid var(--color-border);
      color: var(--color-text-primary);
      padding: var(--space-xs) var(--space-md);
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: all var(--transition-base);
      font-size: 0.875rem;
      font-weight: 500;
    }

    .week-nav__button:hover {
      background-color: var(--color-surface-hover);
      border-color: var(--color-accent);
    }

    .week-nav__button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .week-nav__current {
      font-weight: 500;
      color: var(--color-text-primary);
    }

    /* Filters */
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-sm);
      margin-bottom: var(--space-lg);
    }

    .filter-group {
      display: flex;
      gap: var(--space-sm);
      flex-wrap: wrap;
    }

    .filter-button {
      background-color: var(--color-surface);
      border: 1px solid var(--color-border);
      color: var(--color-text-secondary);
      padding: var(--space-xs) var(--space-md);
      border-radius: 20px;
      cursor: pointer;
      transition: all var(--transition-base);
      font-size: 0.875rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: var(--space-xs);
    }

    .filter-button::before {
      content: '';
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: currentColor;
      opacity: 0.3;
    }

    .filter-button.active {
      background-color: var(--color-surface-hover);
      border-color: currentColor;
      color: var(--color-text-primary);
    }

    .filter-button.active::before {
      opacity: 1;
    }

    .filter-button.online {
      color: var(--color-online);
    }

    .filter-button.campus {
      color: var(--color-campus);
    }

    .filter-button.offcampus {
      color: var(--color-offcampus);
    }

    /* View Switcher */
    .view-switcher {
      display: flex;
      gap: var(--space-xs);
      background-color: var(--color-surface);
      padding: 4px;
      border-radius: var(--border-radius);
      margin-bottom: var(--space-lg);
    }

    .view-button {
      background: none;
      border: none;
      color: var(--color-text-secondary);
      padding: var(--space-xs) var(--space-md);
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all var(--transition-base);
    }

    .view-button:hover {
      color: var(--color-text-primary);
      background-color: var(--color-surface-hover);
    }

    .view-button.active {
      background-color: var(--color-bg);
      color: var(--color-text-primary);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    /* Month View Styles */
    .month-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
      background-color: var(--color-border);
      padding: 2px;
      border-radius: var(--border-radius);
    }

    .month-day {
      background-color: var(--color-surface);
      padding: var(--space-sm);
      min-height: 100px;
      border-radius: 4px;
      cursor: pointer;
      transition: all var(--transition-base);
      position: relative;
      overflow: hidden;
    }

    .month-day:hover {
      background-color: var(--color-surface-hover);
    }

    .month-day.today {
      border: 2px solid var(--color-accent);
    }

    .month-day.outside-conference {
      opacity: 0.3;
      cursor: default;
    }


    .month-day-header {
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: var(--space-xs);
      color: var(--color-text-secondary);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .month-day-sessions {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .month-day-count {
      font-size: 0.625rem;
      background-color: var(--color-bg);
      padding: 2px 6px;
      border-radius: 10px;
      color: var(--color-text-secondary);
    }

    .month-session-item {
      font-size: 0.625rem;
      padding: 2px 4px;
      margin-bottom: 2px;
      border-radius: 3px;
      background-color: var(--color-bg);
      color: var(--color-text-primary);
      display: flex;
      align-items: center;
      gap: 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .month-session-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background-color: var(--category-color);
      flex-shrink: 0;
    }

    .month-day-more {
      font-size: 0.625rem;
      color: var(--color-text-secondary);
      text-align: center;
      padding-top: 2px;
    }

    /* Responsive adjustments for month view */
    @media (max-width: 767px) {
      .month-grid {
        grid-template-columns: repeat(7, 1fr);
        font-size: 0.75rem;
      }

      .month-day {
        min-height: 80px;
        padding: 4px;
      }

      .month-session-item {
        display: none;
      }

      .month-day-sessions {
        display: flex;
        flex-wrap: wrap;
        gap: 2px;
      }

      .month-session-dot {
        width: 8px;
        height: 8px;
      }
    }

    /* Search */
    .search-container {
      position: relative;
      margin-bottom: var(--space-lg);
    }

    .search-input {
      width: 100%;
      background-color: var(--color-surface);
      border: 1px solid var(--color-border);
      color: var(--color-text-primary);
      padding: var(--space-sm) var(--space-md);
      padding-left: 2.5rem;
      border-radius: var(--border-radius);
      font-size: 0.875rem;
      transition: all var(--transition-base);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--color-accent);
      background-color: var(--color-surface-hover);
    }

    .search-icon {
      position: absolute;
      left: var(--space-md);
      top: 50%;
      transform: translateY(-50%);
      color: var(--color-text-muted);
      pointer-events: none;
    }

    /* Week Grid */
    .week-grid {
      display: grid;
      gap: var(--space-md);
      grid-template-columns: 1fr;
      margin-bottom: var(--space-xl);
    }

    .week-grid.three-day-view {
      grid-template-columns: repeat(3, 1fr);
    }

    .week-grid.three-day-view .day-column {
      min-width: unset;
    }

    @media (max-width: 767px) {
      .week-grid.three-day-view {
        grid-template-columns: 1fr;
      }
    }

    @media (min-width: 768px) {
      .week-grid {
        grid-template-columns: repeat(7, 1fr);
        overflow-x: auto;
        padding-bottom: var(--space-sm);
      }

      .week-grid.three-day-view {
        grid-template-columns: repeat(3, 1fr);
        gap: var(--space-md);
      }

      .week-grid.three-day-view .day-column {
        min-width: unset;
      }
    }

    /* Day Column with Time Indicators */
    .day-column {
      background-color: var(--color-surface);
      border-radius: var(--border-radius);
      padding: var(--space-md);
      min-width: 200px;
      position: relative;
    }

    /* Current Time Indicator */
    .time-indicator {
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      background-color: var(--color-accent);
      box-shadow: 0 0 10px rgba(0, 217, 217, 0.5);
      z-index: 10;
      pointer-events: none;
      display: none;
    }

    .time-indicator::before {
      content: '';
      position: absolute;
      left: -8px;
      top: -4px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: var(--color-accent);
      box-shadow: 0 0 0 3px rgba(0, 217, 217, 0.2);
    }

    .time-indicator-label {
      position: absolute;
      right: 8px;
      top: -20px;
      font-size: 0.625rem;
      font-weight: 600;
      color: var(--color-accent);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .day-column.has-current-time .time-indicator {
      display: block;
    }

    /* Session Density Indicator */
    .day-header {
      margin-bottom: var(--space-md);
      padding-bottom: var(--space-sm);
      border-bottom: 1px solid var(--color-border);
      position: relative;
    }

    .session-density {
      position: absolute;
      right: 0;
      top: 0;
      display: flex;
      gap: 2px;
    }

    .density-bar {
      width: 3px;
      height: 20px;
      background-color: var(--color-border);
      border-radius: 2px;
      transition: background-color 200ms ease;
    }

    .density-bar.filled {
      background-color: var(--color-accent);
    }

    .day-name {
      font-weight: 600;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--color-text-secondary);
    }

    .day-date {
      font-size: 1.25rem;
      font-weight: 500;
      color: var(--color-text-primary);
      margin-top: var(--space-xs);
    }

    .day-column.today .day-header {
      border-bottom-color: var(--color-accent);
    }

    .day-column.today .day-date {
      color: var(--color-accent);
    }

    /* Session Cards */
    .session-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .session-card {
      background-color: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: var(--border-radius);
      padding: var(--space-md);
      cursor: pointer;
      transition: all var(--transition-base);
      position: relative;
      overflow: hidden;
    }

    .session-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background-color: var(--category-color);
    }

    .session-card::after {
      content: '';
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      height: 3px;
      background-color: var(--lab-type-color);
      opacity: 0.6;
    }

    .session-card.online {
      --category-color: var(--color-online);
    }

    .session-card.campus {
      --category-color: var(--color-campus);
    }

    .session-card.offcampus {
      --category-color: var(--color-offcampus);
    }

    .session-card[data-lab-type="theory"] {
      --lab-type-color: var(--color-theory);
    }

    .session-card[data-lab-type="wet-lab"] {
      --lab-type-color: var(--color-wet-lab);
    }

    .session-card[data-lab-type="dry-lab"] {
      --lab-type-color: var(--color-dry-lab);
    }

    .session-card[data-lab-type="computational"] {
      --lab-type-color: var(--color-computational);
    }

    .session-card:hover {
      background-color: var(--color-surface-hover);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .session-card.expanded {
      background-color: var(--color-surface-hover);
    }

    .session-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--space-xs);
    }

    .session-time {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--color-text-secondary);
      font-variant-numeric: tabular-nums;
    }

    .session-lab-type {
      font-size: 0.625rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--lab-type-color);
      background-color: rgba(255, 255, 255, 0.05);
      padding: 2px 6px;
      border-radius: 4px;
    }

    .session-title {
      font-weight: 600;
      color: var(--color-text-primary);
      margin-bottom: var(--space-xs);
      line-height: 1.3;
    }

    .session-instructor {
      font-size: 0.875rem;
      color: var(--color-text-secondary);
    }

    .session-capacity {
      font-size: 0.75rem;
      color: var(--color-text-muted);
      margin-top: var(--space-xs);
    }

    .session-capacity.full {
      color: var(--color-wet-lab);
    }

    .session-details {
      margin-top: var(--space-md);
      padding-top: var(--space-md);
      border-top: 1px solid var(--color-border);
      display: grid;
      grid-template-rows: 0fr;
      transition: grid-template-rows 300ms ease-out;
    }

    .session-details-inner {
      overflow: hidden;
    }

    .session-card.expanded .session-details {
      grid-template-rows: 1fr;
    }

    .session-location {
      font-size: 0.875rem;
      color: var(--color-text-secondary);
      margin-bottom: var(--space-sm);
    }

    .session-prerequisites {
      font-size: 0.875rem;
      color: var(--color-campus);
      margin-bottom: var(--space-sm);
    }

    .session-description {
      font-size: 0.875rem;
      line-height: 1.6;
      color: var(--color-text-secondary);
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Stagger animation for cards */
    .session-card {
      animation: slideIn 400ms ease-out backwards;
    }

    .session-card:nth-child(1) {
      animation-delay: 0ms;
    }

    .session-card:nth-child(2) {
      animation-delay: 50ms;
    }

    .session-card:nth-child(3) {
      animation-delay: 100ms;
    }

    .session-card:nth-child(4) {
      animation-delay: 150ms;
    }

    .session-card:nth-child(5) {
      animation-delay: 200ms;
    }

    /* Day column stagger */
    .day-column {
      animation: scaleIn 300ms ease-out backwards;
    }

    .day-column:nth-child(1) {
      animation-delay: 0ms;
    }

    .day-column:nth-child(2) {
      animation-delay: 50ms;
    }

    .day-column:nth-child(3) {
      animation-delay: 100ms;
    }

    .day-column:nth-child(4) {
      animation-delay: 150ms;
    }

    .day-column:nth-child(5) {
      animation-delay: 200ms;
    }

    .day-column:nth-child(6) {
      animation-delay: 250ms;
    }

    .day-column:nth-child(7) {
      animation-delay: 300ms;
    }

    /* Loading State */
    .loading {
      text-align: center;
      padding: var(--space-2xl);
      color: var(--color-text-secondary);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: var(--space-2xl);
      color: var(--color-text-secondary);
    }

    /* Mobile Optimizations */
    @media (max-width: 767px) {
      .container {
        padding: var(--space-sm);
      }

      .header {
        flex-direction: column;
        gap: var(--space-md);
        align-items: flex-start;
      }

      .theme-toggle {
        position: absolute;
        top: var(--space-md);
        right: var(--space-md);
      }

      .week-nav {
        flex-direction: column;
        gap: var(--space-md);
      }

      .filters {
        justify-content: center;
      }

      .day-column {
        margin-bottom: var(--space-md);
      }
    }

    /* Utility Classes */
    .hidden {
      display: none !important;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
  </style>
</head>

<body>
  <div class="container">
    <header class="header">
      <h1>Advanced Microscopy Training Schedule</h1>
      <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
        <svg class="theme-icon sun" fill="currentColor" viewBox="0 0 20 20">
          <path
            d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" />
        </svg>
        <svg class="theme-icon moon" fill="currentColor" viewBox="0 0 20 20">
          <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
        </svg>
      </button>
    </header>

    <nav class="week-nav" role="navigation" aria-label="Week navigation">
      <div class="week-nav__info" id="currentWeek">
        <div class="week-nav__current">Loading...</div>
        <div class="week-nav__stats"></div>
      </div>
      <div class="week-nav__controls">
        <button class="week-nav__button" id="prevWeek" aria-label="Previous week">
          ← Previous
        </button>
        <button class="week-nav__button" id="todayButton" aria-label="Go to today">
          Today
        </button>
        <button class="week-nav__button" id="nextWeek" aria-label="Next week">
          Next →
        </button>
      </div>
    </nav>

    <div class="filters" role="group" aria-label="Filter sessions by category">
      <div class="filter-group">
        <button class="filter-button online active" data-category="online" aria-pressed="true">
          Online Live
        </button>
        <button class="filter-button campus active" data-category="campus" aria-pressed="true">
          On Campus
        </button>
        <button class="filter-button offcampus active" data-category="offcampus" aria-pressed="true">
          Off Campus
        </button>
      </div>
    </div>

    <div class="search-container">
      <svg class="search-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
        <path
          d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
      </svg>
      <input type="search" class="search-input" placeholder="Search sessions or instructors..." id="searchInput"
        aria-label="Search sessions">
    </div>

    <div class="time-context" id="timeContext">
      <div class="happening-now" id="happeningNow" style="display: none;">
        <div class="happening-now__title">Happening Now</div>
        <div class="happening-now__session" id="currentSession"></div>
      </div>

      <div class="up-next-section">
        <div class="time-context__header">Up Next</div>
        <div class="up-next" id="upNext"></div>
      </div>
    </div>

    <div class="view-switcher" role="tablist" aria-label="View options">
      <button class="view-button" role="tab" data-view="month" aria-selected="false">Month</button>
      <button class="view-button active" role="tab" data-view="week" aria-selected="true">Week</button>
      <button class="view-button" role="tab" data-view="3day" aria-selected="false">3 Days</button>
    </div>

    <main class="week-grid" id="weekGrid" role="main">
      <div class="loading">Loading schedule...</div>
    </main>
  </div>

  <script>
    // Sample JSON data structure (in production, this would be in a separate file)
    const CONFERENCE_DATA = {
      "metadata": {
        "conferenceStart": "2025-05-15",
        "conferenceEnd": "2025-06-30",
        "timezone": "America/New_York",
        "defaultSessionDuration": 90,
        "timeSlots": ["10:00", "11:30", "22:00", "22:00"]
      },
      "instructors": {
        "sarah-chen": {
          "id": "sarah-chen",
          "name": "Dr. Sarah Chen",
          "title": "Principal Investigator",
          "specialization": "Confocal Microscopy",
          "email": "s.chen@institute.edu"
        },
        "james-wilson": {
          "id": "james-wilson",
          "name": "Prof. James Wilson",
          "title": "Director of Imaging Core",
          "specialization": "Two-Photon Microscopy"
        },
        "maria-garcia": {
          "id": "maria-garcia",
          "name": "Maria Garcia",
          "title": "Lab Manager",
          "specialization": "Sample Preparation"
        },
        "alex-thompson": {
          "id": "alex-thompson",
          "name": "Dr. Alex Thompson",
          "title": "Computational Biologist",
          "specialization": "Image Analysis"
        }
      },
      "sessionTemplates": [
        {
          "id": "confocal-basics",
          "title": "Confocal Microscopy Fundamentals",
          "category": "campus",
          "labType": "theory",
          "capacity": 30,
          "duration": 120,
          "prerequisites": null,
          "equipment": ["Zeiss LSM 980"],
          "description": "Introduction to confocal microscopy principles, including point scanning, optical sectioning, and fluorescence basics."
        },
        {
          "id": "two-photon-workshop",
          "title": "Two-Photon Imaging Workshop",
          "category": "campus",
          "labType": "wet-lab",
          "capacity": 8,
          "duration": 180,
          "prerequisites": "confocal-basics",
          "equipment": ["Bruker Ultima 2P"],
          "description": "Hands-on training with two-photon microscopy for deep tissue imaging. Includes live sample preparation."
        },
        {
          "id": "image-analysis",
          "title": "Image Analysis with ImageJ/FIJI",
          "category": "online",
          "labType": "computational",
          "capacity": 50,
          "duration": 90,
          "prerequisites": null,
          "equipment": [],
          "description": "Comprehensive workshop on image processing, quantification, and batch analysis using open-source tools."
        }
      ],
      "schedule": []
    };

    // Generate schedule based on templates
    const generateSchedule = () => {
      const schedule = [];
      const start = new Date(CONFERENCE_DATA.metadata.conferenceStart);
      const end = new Date(CONFERENCE_DATA.metadata.conferenceEnd);
      const templates = CONFERENCE_DATA.sessionTemplates;
      const instructorIds = Object.keys(CONFERENCE_DATA.instructors);

      for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
        // Skip weekends
        if (d.getDay() === 0 || d.getDay() === 6) continue;

        // 2-4 sessions per day
        const sessionsPerDay = Math.floor(Math.random() * 3) + 2;
        const daySlots = [...CONFERENCE_DATA.metadata.timeSlots];

        for (let i = 0; i < sessionsPerDay && i < daySlots.length; i++) {
          const template = templates[Math.floor(Math.random() * templates.length)];
          const instructor = instructorIds[Math.floor(Math.random() * instructorIds.length)];
          const timeSlot = daySlots[i];

          schedule.push({
            id: `session-${d.toISOString().split('T')[0]}-${i}`,
            date: d.toISOString().split('T')[0],
            startTime: timeSlot,
            templateId: template.id,
            instructorId: instructor,
            enrolled: Math.floor(Math.random() * template.capacity * 0.8)
          });
        }
      }

      return schedule;
    };

    // Set the schedule
    CONFERENCE_DATA.schedule = generateSchedule();

    // Namespace for our application
    const ConferenceSchedule = (() => {
      'use strict';

      // State management
      const state = {
        currentWeekStart: null,
        sessions: [],
        filteredSessions: [],
        activeFilters: new Set(['online', 'campus', 'offcampus']),
        searchQuery: '',
        expandedSessions: new Set(),
        conferenceData: null,
        currentView: 'week'
      };

      // Constants
      const DAYS_IN_WEEK = 7;
      let CONFERENCE_START;
      let CONFERENCE_END;

      // Data loading and parsing
      const loadConferenceData = async () => {
        try {
          // In production, this would be: const response = await fetch('./data/conference.json');
          // For now, we'll use the embedded data
          state.conferenceData = CONFERENCE_DATA;

          // Set conference dates
          CONFERENCE_START = new Date(state.conferenceData.metadata.conferenceStart);
          CONFERENCE_END = new Date(state.conferenceData.metadata.conferenceEnd);

          // Parse sessions
          state.sessions = state.conferenceData.schedule.map(scheduleItem => {
            const template = state.conferenceData.sessionTemplates.find(t => t.id === scheduleItem.templateId);
            const instructor = state.conferenceData.instructors[scheduleItem.instructorId];

            return {
              id: scheduleItem.id,
              date: scheduleItem.date,
              startTime: scheduleItem.startTime,
              endTime: addMinutes(scheduleItem.startTime, template.duration),
              title: template.title,
              instructor: instructor.name,
              instructorTitle: instructor.title,
              category: template.category,
              labType: template.labType,
              capacity: template.capacity,
              enrolled: scheduleItem.enrolled,
              prerequisites: template.prerequisites,
              description: template.description,
              location: getLocation(template)
            };
          });

          return true;
        } catch (error) {
          console.error('Failed to load conference data:', error);
          return false;
        }
      };

      const getLocation = (template) => {
        if (template.category === 'online') return 'Zoom Room A';
        if (template.category === 'campus') {
          return template.labType === 'wet-lab' ? 'Building 3, Imaging Core' : 'Building 2, Computer Lab';
        }
        return 'Partner Institute, Room 201';
      };

      // Utility functions
      const addMinutes = (time, minutes) => {
        const [h, m] = time.split(':').map(Number);
        const totalMinutes = h * 60 + m + minutes;
        const newHours = Math.floor(totalMinutes / 60);
        const newMinutes = totalMinutes % 60;
        return `${newHours.toString().padStart(2, '0')}:${newMinutes.toString().padStart(2, '0')}`;
      };

      const formatDate = (date) => {
        const options = {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'};
        return date.toLocaleDateString('en-US', options);
      };

      const getWeekStart = (date) => {
        const d = new Date(date);
        const day = d.getDay();
        const diff = d.getDate() - day;
        return new Date(d.setDate(diff));
      };

      const getWeekDates = (weekStart) => {
        const dates = [];
        for (let i = 0; i < DAYS_IN_WEEK; i++) {
          const date = new Date(weekStart);
          date.setDate(weekStart.getDate() + i);
          dates.push(date);
        }
        return dates;
      };

      const isToday = (date) => {
        const today = new Date();
        return date.toDateString() === today.toDateString();
      };

      // Filtering logic
      const filterSessions = () => {
        state.filteredSessions = state.sessions.filter(session => {
          // Category filter
          if (!state.activeFilters.has(session.category)) {
            return false;
          }

          // Search filter
          if (state.searchQuery) {
            const query = state.searchQuery.toLowerCase();
            const matchesTitle = session.title.toLowerCase().includes(query);
            const matchesInstructor = session.instructor.toLowerCase().includes(query);
            if (!matchesTitle && !matchesInstructor) {
              return false;
            }
          }

          return true;
        });
      };

      // DOM manipulation
      const renderWeek = () => {
        const weekGrid = document.getElementById('weekGrid');
        weekGrid.className = 'week-grid'; // Reset to just week-grid
        const weekDates = getWeekDates(state.currentWeekStart);

        // Clear existing content
        weekGrid.innerHTML = '';

        // Calculate stats for the week
        const weekStats = calculateWeekStats(weekDates);

        // Update week navigation with stats
        updateWeekNavigation(weekStats);

        // Render each day
        weekDates.forEach((date, index) => {
          const dayColumn = createDayColumn(date);
          weekGrid.appendChild(dayColumn);
        });

        // Update current time indicator
        updateTimeIndicator();

        // Update navigation buttons
        updateNavigationButtons();
      };

      const renderView = () => {
        let dates = [];

        switch (state.currentView) {
          case 'month':
            // For month view, we'll calculate stats differently
            renderMonth();
            const monthStats = calculateWeekStats([]); // Pass empty array, function handles month logic
            updateWeekNavigation(monthStats);
            break;

          case '3day':
            render3Day();
            // Calculate stats for 3 days
            const today = new Date();
            dates = [];
            for (let i = 0; i < 3; i++) {
              const date = new Date(today);
              date.setDate(today.getDate() + i);
              dates.push(date);
            }
            const threeDayStats = calculateWeekStats(dates);
            updateWeekNavigation(threeDayStats);
            break;

          default:
            renderWeek();
          // Stats are calculated within renderWeek
        }
        updateTimeContext();
      };

      const renderMonth = () => {
        const weekGrid = document.getElementById('weekGrid');
        weekGrid.innerHTML = '';
        weekGrid.className = 'month-grid';

        // Get first day of month
        const monthStart = new Date(state.currentWeekStart);
        monthStart.setDate(1);

        // Get last day of month
        const monthEnd = new Date(monthStart);
        monthEnd.setMonth(monthEnd.getMonth() + 1);
        monthEnd.setDate(0);

        // Add day headers
        const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        dayHeaders.forEach(day => {
          const header = document.createElement('div');
          header.className = 'month-day-header';
          header.textContent = day;
          header.style.textAlign = 'center';
          weekGrid.appendChild(header);
        });

        // Add empty cells for start of month
        const startDay = monthStart.getDay();
        for (let i = 0; i < startDay; i++) {
          const emptyDay = document.createElement('div');
          emptyDay.className = 'month-day empty';
          weekGrid.appendChild(emptyDay);
        }

        // Add days
        for (let d = new Date(monthStart); d <= monthEnd; d.setDate(d.getDate() + 1)) {
          const dayCell = createMonthDay(new Date(d));
          weekGrid.appendChild(dayCell);
        }
      };

      const createMonthDay = (date) => {
        const dayCell = document.createElement('div');
        const dateStr = date.toISOString().split('T')[0];
        const isOutside = date < CONFERENCE_START || date > CONFERENCE_END;

        dayCell.className = `month-day ${isToday(date) ? 'today' : ''} ${isOutside ? 'outside-conference' : ''}`;

        // Header with date and count
        const dayHeader = document.createElement('div');
        dayHeader.className = 'month-day-header';

        const dayNumber = document.createElement('span');
        dayNumber.textContent = date.getDate();

        // Get sessions for this day
        const daySessions = state.filteredSessions.filter(s => s.date === dateStr);

        dayHeader.appendChild(dayNumber);

        if (daySessions.length > 0) {
          const count = document.createElement('span');
          count.className = 'month-day-count';
          count.textContent = daySessions.length;
          dayHeader.appendChild(count);
        }

        dayCell.appendChild(dayHeader);

        // Sessions container
        const sessionsContainer = document.createElement('div');
        sessionsContainer.className = 'month-day-sessions';

        // On desktop, show session titles; on mobile, show dots
        const isMobile = window.innerWidth <= 767;

        if (!isMobile && daySessions.length > 0) {
          // Show first 2 sessions with titles
          daySessions.slice(0, 2).forEach(session => {
            const sessionItem = document.createElement('div');
            sessionItem.className = 'month-session-item';

            const dot = document.createElement('div');
            dot.className = `month-session-dot ${session.category}`;
            dot.style.setProperty('--category-color', `var(--color-${session.category})`);

            const time = document.createElement('span');
            time.textContent = session.startTime;
            time.style.marginRight = '4px';
            time.style.opacity = '0.7';

            const title = document.createElement('span');
            title.textContent = session.title.length > 20 ?
              session.title.substring(0, 20) + '...' : session.title;

            sessionItem.appendChild(dot);
            sessionItem.appendChild(time);
            sessionItem.appendChild(title);
            sessionsContainer.appendChild(sessionItem);
          });

          if (daySessions.length > 2) {
            const more = document.createElement('div');
            more.className = 'month-day-more';
            more.textContent = `+${daySessions.length - 2} more`;
            sessionsContainer.appendChild(more);
          }
        } else if (daySessions.length > 0) {
          // Mobile view - show dots
          daySessions.slice(0, 6).forEach(session => {
            const dot = document.createElement('div');
            dot.className = `month-session-dot ${session.category}`;
            dot.style.setProperty('--category-color', `var(--color-${session.category})`);
            sessionsContainer.appendChild(dot);
          });

          if (daySessions.length > 6) {
            const more = document.createElement('div');
            more.className = 'month-day-more';
            more.textContent = `+${daySessions.length - 6}`;
            more.style.width = '100%';
            sessionsContainer.appendChild(more);
          }
        }

        dayCell.appendChild(sessionsContainer);

        // Click to go to week view (unless outside conference dates)
        if (!isOutside) {
          dayCell.addEventListener('click', () => {
            state.currentWeekStart = getWeekStart(date);
            state.currentView = 'week';
            updateViewButtons();
            renderView();
          });
        }

        return dayCell;
      };

      const render3Day = () => {
        const weekGrid = document.getElementById('weekGrid');
        weekGrid.className = 'week-grid three-day-view';
        weekGrid.innerHTML = '';

        const today = new Date();
        const dates = [];

        // For 3-day view, check if we're within conference dates
        let startDate;
        if (today >= CONFERENCE_START && today <= CONFERENCE_END) {
          startDate = today;
        } else if (today < CONFERENCE_START) {
          startDate = CONFERENCE_START;
        } else {
          // If after conference, show last 3 days
          startDate = new Date(CONFERENCE_END);
          startDate.setDate(startDate.getDate() - 2);
        }

        // Show 3 consecutive days
        for (let i = 0; i < 3; i++) {
          const date = new Date(startDate);
          date.setDate(startDate.getDate() + i);
          if (date <= CONFERENCE_END) {
            dates.push(date);
          }
        }

        dates.forEach(date => {
          const dayColumn = createDayColumn(date);
          weekGrid.appendChild(dayColumn);
        });

        updateTimeIndicator();
      };

      const updateViewButtons = () => {
        document.querySelectorAll('.view-button').forEach(btn => {
          const isActive = btn.dataset.view === state.currentView;
          btn.classList.toggle('active', isActive);
          btn.setAttribute('aria-selected', isActive);
        });
      };

      const calculateWeekStats = (dates) => {
        const stats = {
          total: 0,
          byCategory: {online: 0, campus: 0, offcampus: 0}
        };

        // For month view, calculate for entire month
        if (state.currentView === 'month') {
          const monthStart = new Date(state.currentWeekStart);
          monthStart.setDate(1);
          const monthEnd = new Date(monthStart);
          monthEnd.setMonth(monthEnd.getMonth() + 1);
          monthEnd.setDate(0);

          for (let d = new Date(monthStart); d <= monthEnd; d.setDate(d.getDate() + 1)) {
            const dateStr = d.toISOString().split('T')[0];
            const daySessions = state.filteredSessions.filter(s => s.date === dateStr);
            stats.total += daySessions.length;
            daySessions.forEach(session => {
              stats.byCategory[session.category]++;
            });
          }
        } else {
          // Original logic for week and 3-day views
          dates.forEach(date => {
            const dateStr = date.toISOString().split('T')[0];
            const daySessions = state.filteredSessions.filter(s => s.date === dateStr);

            stats.total += daySessions.length;
            daySessions.forEach(session => {
              stats.byCategory[session.category]++;
            });
          });
        }

        return stats;
      };

      const updateWeekNavigation = (stats) => {
        const currentWeekEl = document.getElementById('currentWeek');
        let dateRangeText = '';

        switch (state.currentView) {
          case 'month':
            const monthDate = new Date(state.currentWeekStart);
            dateRangeText = monthDate.toLocaleDateString('en-US', {month: 'long', year: 'numeric'});
            break;

          case '3day':
            const today = new Date();
            const endDate = new Date(today);
            endDate.setDate(today.getDate() + 2);
            dateRangeText = `${formatDate(today).split(',')[1].trim()} - ${formatDate(endDate).split(',')[1].trim()}`;
            break;

          default: // week view
            const weekEndDate = new Date(state.currentWeekStart);
            weekEndDate.setDate(weekEndDate.getDate() + 6);
            dateRangeText = `${formatDate(state.currentWeekStart).split(',')[1].trim()} - ${formatDate(weekEndDate).split(',')[1].trim()}`;
        }

        currentWeekEl.innerHTML = `
        <div class="week-nav__current">
            ${dateRangeText}
        </div>
        <div class="week-nav__stats">
            <div class="stat-item">
                <span>${stats.total} sessions</span>
            </div>
            <div class="stat-item" style="color: var(--color-online)">
                <span class="stat-dot"></span>
                <span>${stats.byCategory.online}</span>
            </div>
            <div class="stat-item" style="color: var(--color-campus)">
                <span class="stat-dot"></span>
                <span>${stats.byCategory.campus}</span>
            </div>
            <div class="stat-item" style="color: var(--color-offcampus)">
                <span class="stat-dot"></span>
                <span>${stats.byCategory.offcampus}</span>
            </div>
        </div>
    `;
      };

      const createDayColumn = (date) => {
        const dayColumn = document.createElement('div');
        dayColumn.className = `day-column ${isToday(date) ? 'today' : ''}`;

        // Day header with density indicator
        const dayHeader = document.createElement('div');
        dayHeader.className = 'day-header';

        const dayName = document.createElement('div');
        dayName.className = 'day-name';
        dayName.textContent = date.toLocaleDateString('en-US', {weekday: 'short'});

        const dayDate = document.createElement('div');
        dayDate.className = 'day-date';
        dayDate.textContent = date.getDate();

        // Session density indicator
        const dateStr = date.toISOString().split('T')[0];
        const daySessions = state.filteredSessions
          .filter(session => session.date === dateStr)
          .sort((a, b) => a.startTime.localeCompare(b.startTime));

        const densityIndicator = createDensityIndicator(daySessions.length);

        dayHeader.appendChild(dayName);
        dayHeader.appendChild(dayDate);
        dayHeader.appendChild(densityIndicator);
        dayColumn.appendChild(dayHeader);

        // Session list
        const sessionList = document.createElement('div');
        sessionList.className = 'session-list';

        if (daySessions.length === 0) {
          const emptyState = document.createElement('div');
          emptyState.className = 'empty-state';
          emptyState.textContent = 'No sessions';
          sessionList.appendChild(emptyState);
        } else {
          // Group sessions by time blocks
          const timeBlocks = groupSessionsByTimeBlock(daySessions);

          Object.entries(timeBlocks).forEach(([time, sessions]) => {
            sessions.forEach(session => {
              const sessionCard = createSessionCard(session);
              sessionList.appendChild(sessionCard);
            });
          });
        }

        dayColumn.appendChild(sessionList);

        // Add time indicator if today
        if (isToday(date)) {
          const timeIndicator = createTimeIndicator();
          dayColumn.appendChild(timeIndicator);
          dayColumn.classList.add('has-current-time');
        }

        return dayColumn;
      };

      const createDensityIndicator = (sessionCount) => {
        const densityContainer = document.createElement('div');
        densityContainer.className = 'session-density';

        const maxBars = 4;
        const filledBars = Math.min(sessionCount, maxBars);

        for (let i = 0; i < maxBars; i++) {
          const bar = document.createElement('div');
          bar.className = `density-bar ${i < filledBars ? 'filled' : ''}`;
          densityContainer.appendChild(bar);
        }

        return densityContainer;
      };

      const createTimeIndicator = () => {
        const indicator = document.createElement('div');
        indicator.className = 'time-indicator';

        const label = document.createElement('div');
        label.className = 'time-indicator-label';
        label.textContent = 'NOW';

        indicator.appendChild(label);
        return indicator;
      };

      const groupSessionsByTimeBlock = (sessions) => {
        const blocks = {};
        sessions.forEach(session => {
          const hour = parseInt(session.startTime.split(':')[0]);
          const block = hour < 12 ? 'morning' : 'afternoon';

          if (!blocks[block]) blocks[block] = [];
          blocks[block].push(session);
        });
        return blocks;
      };

      const updateTimeIndicator = () => {
        const now = new Date();
        const currentHour = now.getHours();
        const currentMinutes = now.getMinutes();

        // Only show during conference hours (10am - 5pm)
        if (currentHour < 10 || currentHour >= 17) return;

        const todayColumn = document.querySelector('.day-column.today');
        if (!todayColumn) return;

        const indicator = todayColumn.querySelector('.time-indicator');
        if (!indicator) return;

        // Calculate position based on conference hours
        const startHour = 10;
        const endHour = 17;
        const totalMinutes = (endHour - startHour) * 60;
        const currentMinutesFromStart = ((currentHour - startHour) * 60) + currentMinutes;
        const percentage = (currentMinutesFromStart / totalMinutes) * 100;

        // Position the indicator
        const headerHeight = todayColumn.querySelector('.day-header').offsetHeight;
        const sessionListHeight = todayColumn.querySelector('.session-list').offsetHeight;
        const topPosition = headerHeight + (sessionListHeight * percentage / 100);

        indicator.style.top = `${topPosition}px`;
      };

      const updateTimeContext = () => {
        const now = new Date();
        const timeContext = document.getElementById('timeContext');

        // Only show during conference dates
        if (now < CONFERENCE_START || now > CONFERENCE_END) {
          timeContext.classList.remove('active');
          return;
        }

        const todayStr = now.toISOString().split('T')[0];
        const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;

        // Get today's sessions
        const todaySessions = state.filteredSessions
          .filter(s => s.date === todayStr)
          .sort((a, b) => a.startTime.localeCompare(b.startTime));

        if (todaySessions.length === 0) {
          timeContext.classList.remove('active');
          return;
        }

        timeContext.classList.add('active');

        // Find current session
        const currentSession = todaySessions.find(session =>
          currentTime >= session.startTime && currentTime <= session.endTime
        );

        // Update happening now
        const happeningNowEl = document.getElementById('happeningNow');
        const currentSessionEl = document.getElementById('currentSession');

        if (currentSession) {
          happeningNowEl.style.display = 'block';
          currentSessionEl.innerHTML = `
            <div><strong>${currentSession.title}</strong></div>
            <div style="font-size: 0.75rem; color: var(--color-text-secondary); margin-top: 4px;">
                ${currentSession.instructor} • ${currentSession.startTime} - ${currentSession.endTime}
            </div>
        `;
        } else {
          happeningNowEl.style.display = 'none';
        }

        // Find upcoming sessions
        const upcomingSessions = todaySessions.filter(session =>
          session.startTime > currentTime
        ).slice(0, 3); // Show next 3 sessions

        // Update up next
        const upNextEl = document.getElementById('upNext');

        if (upcomingSessions.length > 0) {
          upNextEl.innerHTML = upcomingSessions.map(session => {
            const countdown = getCountdown(now, session.startTime);
            return `
                <div class="up-next__item">
                    <div class="up-next__time">${session.startTime}</div>
                    <div class="up-next__countdown">${countdown}</div>
                    <div class="up-next__title">${session.title}</div>
                </div>
            `;
          }).join('');
        } else {
          upNextEl.innerHTML = '<div class="empty-state">No more sessions today</div>';
        }
      };

      const getCountdown = (now, startTime) => {
        const [hours, minutes] = startTime.split(':').map(Number);
        const sessionStart = new Date(now);
        sessionStart.setHours(hours, minutes, 0, 0);

        const diffMs = sessionStart - now;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMins / 60);
        const remainingMins = diffMins % 60;

        if (diffHours > 0) {
          return `in ${diffHours}h ${remainingMins}m`;
        } else if (diffMins > 0) {
          return `in ${diffMins} minutes`;
        } else {
          return 'Starting soon';
        }
      };

      const createSessionCard = (session) => {
        const card = document.createElement('article');
        card.className = `session-card ${session.category} ${state.expandedSessions.has(session.id) ? 'expanded' : ''}`;
        card.setAttribute('data-lab-type', session.labType);
        card.setAttribute('role', 'button');
        card.setAttribute('aria-expanded', state.expandedSessions.has(session.id));
        card.setAttribute('tabindex', '0');

        // Header with time and lab type
        const header = document.createElement('div');
        header.className = 'session-header';

        const time = document.createElement('div');
        time.className = 'session-time';
        time.textContent = `${session.startTime} - ${session.endTime}`;

        const labType = document.createElement('div');
        labType.className = 'session-lab-type';
        labType.textContent = session.labType.replace('-', ' ');

        header.appendChild(time);
        header.appendChild(labType);

        // Basic info
        const title = document.createElement('h3');
        title.className = 'session-title';
        title.textContent = session.title;

        const instructor = document.createElement('div');
        instructor.className = 'session-instructor';
        instructor.textContent = session.instructor;

        // Capacity info
        const capacity = document.createElement('div');
        capacity.className = `session-capacity ${session.enrolled >= session.capacity ? 'full' : ''}`;
        capacity.textContent = `${session.enrolled}/${session.capacity} participants`;

        card.appendChild(header);
        card.appendChild(title);
        card.appendChild(instructor);
        card.appendChild(capacity);

        // Expanded details
        const details = document.createElement('div');
        details.className = 'session-details';

        const detailsInner = document.createElement('div');
        detailsInner.className = 'session-details-inner';

        const location = document.createElement('div');
        location.className = 'session-location';
        location.textContent = `📍 ${session.location}`;

        detailsInner.appendChild(location);

        if (session.prerequisites) {
          const prerequisites = document.createElement('div');
          prerequisites.className = 'session-prerequisites';
          prerequisites.textContent = `⚠️ Requires: ${session.prerequisites}`;
          detailsInner.appendChild(prerequisites);
        }

        const description = document.createElement('p');
        description.className = 'session-description';
        description.textContent = session.description;

        detailsInner.appendChild(description);
        details.appendChild(detailsInner);
        card.appendChild(details);

        // Event listeners
        card.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          toggleSessionExpansion(session.id)
        });
        card.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            e.stopPropagation();
            toggleSessionExpansion(session.id);
          }
        });

        return card;
      };

      const toggleSessionExpansion = (sessionId) => {
        if (state.expandedSessions.has(sessionId)) {
          state.expandedSessions.delete(sessionId);
        } else {
          state.expandedSessions.add(sessionId);
        }
        renderView();
      };

      const updateNavigationButtons = () => {
        const prevButton = document.getElementById('prevWeek');
        const nextButton = document.getElementById('nextWeek');

        // Check if we can go back
        const prevWeekStart = new Date(state.currentWeekStart);
        prevWeekStart.setDate(prevWeekStart.getDate() - 7);
        prevButton.disabled = prevWeekStart < CONFERENCE_START;

        // Check if we can go forward
        const nextWeekStart = new Date(state.currentWeekStart);
        nextWeekStart.setDate(nextWeekStart.getDate() + 7);
        nextButton.disabled = nextWeekStart > CONFERENCE_END;
      };

      // Event handlers
      const handleWeekNavigation = (direction) => {
        const newDate = new Date(state.currentWeekStart);
        newDate.setDate(newDate.getDate() + (direction * 7));

        if (newDate >= CONFERENCE_START && newDate <= CONFERENCE_END) {
          state.currentWeekStart = newDate;
          renderView();
        }
      };

      const handleTodayButton = () => {
        const today = new Date();
        if (today >= CONFERENCE_START && today <= CONFERENCE_END) {
          state.currentWeekStart = getWeekStart(today);
          renderView();
        }
      };

      const handleFilterToggle = (category) => {
        if (state.activeFilters.has(category)) {
          state.activeFilters.delete(category);
        } else {
          state.activeFilters.add(category);
        }
        filterSessions();
        renderView();
      };

      const handleSearch = (query) => {
        state.searchQuery = query;
        filterSessions();
        renderView();
      };

      // Initialize
      const init = async () => {
        // Set initial theme
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);

        // Show loading state
        const weekGrid = document.getElementById('weekGrid');
        weekGrid.innerHTML = '<div class="loading">Loading schedule...</div>';

        // Load conference data
        const dataLoaded = await loadConferenceData();
        if (!dataLoaded) {
          weekGrid.innerHTML = '<div class="empty-state">Failed to load schedule. Please refresh the page.</div>';
          return;
        }

        // Set initial week
        const today = new Date();
        if (today >= CONFERENCE_START && today <= CONFERENCE_END) {
          state.currentWeekStart = getWeekStart(today);
        } else {
          state.currentWeekStart = getWeekStart(CONFERENCE_START);
        }

        // Initial filter
        filterSessions();

        // Attach event listeners
        document.getElementById('prevWeek').addEventListener('click', () => handleWeekNavigation(-1));
        document.getElementById('nextWeek').addEventListener('click', () => handleWeekNavigation(1));
        document.getElementById('todayButton').addEventListener('click', handleTodayButton);

        // Theme toggle
        document.getElementById('themeToggle').addEventListener('click', () => {
          const currentTheme = document.documentElement.getAttribute('data-theme');
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          document.documentElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
        });

        // View switcher
        document.querySelectorAll('.view-button').forEach(button => {
          button.addEventListener('click', () => {
            state.currentView = button.dataset.view;
            updateViewButtons();
            renderView();
          });
        });

        // Filter buttons
        document.querySelectorAll('.filter-button').forEach(button => {
          button.addEventListener('click', () => {
            const category = button.dataset.category;
            button.classList.toggle('active');
            button.setAttribute('aria-pressed', button.classList.contains('active'));
            handleFilterToggle(category);
          });
        });

        // Search input
        const searchInput = document.getElementById('searchInput');
        let searchTimeout;
        searchInput.addEventListener('input', (e) => {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            handleSearch(e.target.value);
          }, 300); // Debounce search
        });

        // Render initial view
        renderView();

        // Update time indicator every minute
        setInterval(updateTimeIndicator, 60000);

        // Initial time context update
        updateTimeContext();
      };

      // Public API
      return {
        init
      };
    })();

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', ConferenceSchedule.init);
    } else {
      ConferenceSchedule.init();
    }
  </script>
</body>

</html>
